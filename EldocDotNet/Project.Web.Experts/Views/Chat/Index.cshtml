@section styles{
    <style>
        [v-cloak] {
            display: none;
        }
    </style>
}
    @section scripts{
    <script src="//cdn.jsdelivr.net/npm/vue@2.6.11" type="text/javascript"></script>
    <script src="/js/signalr/dist/browser/signalr.min.js"></script>
    <script src="/js/pages/chats/index.js?@DateTime.Now.Ticks"></script>
}
    <div class="row g-6 g-xl-9" id="chat_items_container">
        <div class="col-md-4" v-for="item in chatItems" v-cloak>
            <div class="card">
                <div class="card-body d-flex flex-center flex-column p-9">
                    <div class="mb-5">
                        <div class="symbol symbol-75px symbol-circle">
                            <span class="symbol-label bg-light-danger text-danger fs-5 fw-bolder">{{item.user.substring(0,1)}}</span>
                        </div>
                    </div>
                    <a href="javascript:;" class="fs-4 text-gray-800 text-hover-primary fw-bolder mb-0">{{item.user}}</a>
                    <div class="fw-bold text-gray-400 mb-6">{{item.updatedAtFormatted}}</div>
                    <div class="d-flex flex-center flex-wrap mb-5">
                        <div class="border border-gray-300 border-dashed rounded min-w-125px py-3 px-4 mx-3 mb-3">
                            <span class="fs-6 fw-bolder text-gray-700">{{item.totalMessages}}</span>
                            <div class="fw-bold text-gray-400">کل پیام ها</div>
                        </div>
                        <div class="border border-gray-300 border-dashed rounded min-w-125px py-3 mx-3 px-4 mb-3">
                            <code class="fs-6 fw-bolder">#{{item.id}}</code>
                            <div class="fw-bold text-gray-400">کد درخواست</div>
                        </div>
                    </div>
                    <button v-if="item.inProgress" class="btn btn-sm btn-light-primary fw-bolder" data-kt-drawer-show="true" v-on:click="GetMessages(item.id,item.user)" data-kt-drawer-target="#kt_drawer_chat">ارسال پیام</button>
                    <span v-else class="badge badge-dark fw-bolder">پایان یافته</span>
                </div>
            </div>
        </div>
    </div>

    @section modals {
    <div id="kt_drawer_chat" class="bg-body" data-kt-drawer="true" data-kt-drawer-name="chat" data-kt-drawer-activate="true" data-kt-drawer-overlay="true" data-kt-drawer-width="{default:'100%','md': '500px'}" data-kt-drawer-direction="end" data-kt-drawer-toggle="#kt_drawer_chat_toggle" data-kt-drawer-close="#kt_drawer_chat_close">
        <div class="card w-100 rounded-0 border-0" id="kt_drawer_chat_messenger">
            <div class="card-header pe-5" id="kt_drawer_chat_messenger_header">
                <div class="card-title">
                    <div class="d-flex justify-content-center flex-column me-3">
                        <a href="javascript:;" data-currentchatuser class="fs-4 fw-bolder text-gray-900 text-hover-primary me-1 mb-2 lh-1"></a>
                    </div>
                </div>
                <div class="card-toolbar">
                    <div class="me-2">
                        <button class="btn btn-sm btn-icon btn-active-light-primary" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
                            <i class="bi bi-three-dots fs-3"></i>
                        </button>
                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-bold w-200px py-3" data-kt-menu="true">
                            <div class="menu-item px-3 my-1">
                                <a href="javascript:wrapper.FinishCurrentChat();" class="menu-link px-3">پایان مذاکره</a>
                            </div>
                        </div>
                    </div>
                    <div class="btn btn-sm btn-icon btn-active-light-primary" id="kt_drawer_chat_close">
                        <span class="svg-icon svg-icon-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1" transform="rotate(-45 6 17.3137)" fill="currentColor" />
                                <rect x="7.41422" y="6" width="16" height="2" rx="1" transform="rotate(45 7.41422 6)" fill="currentColor" />
                            </svg>
                        </span>
                    </div>
                </div>
            </div>
            <div class="card-body" id="kt_drawer_chat_messenger_body">
                <div class="scroll-y me-n5 pe-5" data-kt-element="messages" data-kt-scroll="true" data-kt-scroll-activate="true" data-kt-scroll-height="auto" data-kt-scroll-dependencies="#kt_drawer_chat_messenger_header, #kt_drawer_chat_messenger_footer" data-kt-scroll-wrappers="#kt_drawer_chat_messenger_body" data-kt-scroll-offset="0px">
                </div>
            </div>
            <div class="card-footer pt-4" id="kt_drawer_chat_messenger_footer">
                <textarea class="form-control form-control-flush mb-3" rows="2" data-kt-element="input" placeholder="متن پیام"></textarea>
                <div class="d-flex flex-stack">
                    <button class="btn btn-primary" type="button" data-kt-element="send">ارسال</button>
                </div>
            </div>
        </div>
    </div>
    }