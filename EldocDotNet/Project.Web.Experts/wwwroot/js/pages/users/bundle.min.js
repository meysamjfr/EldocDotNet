"use strict";var KTDatatablesServerSide=function(){var n,c;const i="/users";const r=document.getElementById("info_modal");r.addEventListener("hidden.bs.modal",function(){n.draw()});const u=new bootstrap.Modal(r),f=document.getElementById("modal_form"),e=document.getElementById("roles_modal");e.addEventListener("hidden.bs.modal",function(){n.draw()});const l=new bootstrap.Modal(e),t=document.getElementById("roles_modal_form");var a=function(){n=$("#kt_datatable_example_1").DataTable({select:{style:"multi",selector:'td:first-child input[type="checkbox"]',className:"row-selected"},ordering:!1,ajax:{method:"post",url:`${i}/getdata`},columns:[{data:"id",orderable:!1,render:function(n){return`
                            <div class="form-check form-check-sm form-check-custom form-check-solid">
                                <input class="form-check-input" type="checkbox" value="${n}" />
                            </div>`}},{data:"userName"},{data:"email"},{data:"phoneNumber"},{data:"id",orderable:!1,className:"text-end",render:function(n,t,i,r){let u='<div class="btn-group btn-group-sm px-2">';return u+=`<button class="btn btn-sm btn-icon btn-light-info" data-kt-docs-table-action="edit_row" data-bs-toggle="tooltip" title="ویرایش" data-index="${r.row}"><i class="bi bi-pen"></i></button>`,u+=`<button class="btn btn-sm btn-icon btn-light-success" data-kt-docs-table-action="roles_row" data-bs-toggle="tooltip" title="دسترسی ها" data-index="${r.row}"><i class="bi bi-shield"></i></button>`,u+=`<button class="btn btn-sm btn-icon btn-light-danger" data-kt-docs-table-action="delete_row" data-bs-toggle="tooltip" title="حذف" data-id="${n}"><i class="bi bi-trash"></i></button>`,u+"<\/div>"}},],createdRow:function(){}});c=n.$;n.on("draw",function(){s();h();o();KTMenu.createInstances();KTApp.initBootstrapTooltips()})},v=function(){const n=document.querySelector('[data-kt-docs-table-toolbar="add"]');n.addEventListener("click",function(){f.reset();f.querySelector('[name="id"]').value="";u.show()})},y=function(){const t=document.querySelector('[data-kt-docs-table-filter="search"]');t.addEventListener("keyup",function(t){n.search(t.target.value).draw()})},o=()=>{const r=document.querySelectorAll('[data-kt-docs-table-action="delete_row"]'),f=document.querySelectorAll('[data-kt-docs-table-action="edit_row"]'),e=document.querySelectorAll('[data-kt-docs-table-action="roles_row"]');r.forEach(t=>{t.addEventListener("click",function(t){t.preventDefault();let r=t.target.closest("button").dataset.id;SwalConfirm.fire().then(function(t){t.value&&fetch(`${i}/delete/${r}`).then(n=>n.json()).then(t=>{t.status==1?(toastr.success(t.message),n.draw()):(toastr.error(t.message),t.errors.forEach(n=>{toastr.warning(n)}))}).catch(()=>toastr.error("خطای سرور"))})})});f.forEach(t=>{t.addEventListener("click",function(t){t.preventDefault();let i=t.target.closest("button").dataset.index;document.querySelector('input[name="userName"]').value=n.row(i).data().userName;document.querySelector('input[name="email"]').value=n.row(i).data().email;document.querySelector('input[name="phoneNumber"]').value=n.row(i).data().phoneNumber;document.querySelector('input[name="id"]').value=n.row(i).data().id;u.show()})});e.forEach(i=>{i.addEventListener("click",function(i){i.preventDefault();let r=i.target.closest("button").dataset.index;t.reset();t.querySelector('[name="id"]').value=n.row(r).data().id;l.show();n.row(r).data().roleIds.forEach(n=>{t.querySelector('[value="'+n+'"]').checked=!0});console.log(n.row(r).data())})})},p=()=>{const r=t.querySelector('[data-kt-roles-modal-action="submit"]');r.addEventListener("click",u=>{u.preventDefault(),r.setAttribute("data-kt-indicator","on"),r.disabled=!0,fetch(`${i}/editroles`,{method:"POST",body:new FormData(t)}).then(n=>n.json()).then(t=>{n.draw(),r.removeAttribute("data-kt-indicator"),r.disabled=!1,t.status==1?(toastr.success(t.message),u.isConfirmed):(toastr.error(t.message),t.errors.forEach(n=>{toastr.warning(n)}))}).catch(n=>{console.log(n)})})},w=()=>{const t=document.querySelector('[data-kt-docs-table-select="deselect"]'),i=document.querySelector("#kt_datatable_example_1");t.addEventListener("click",function(){const t=i.querySelectorAll('[type="checkbox"]')[0];t.checked=!1;n.draw()})},s=function(){const u=document.querySelector("#kt_datatable_example_1"),f=u.querySelectorAll('[type="checkbox"]'),e=document.querySelector('[data-kt-docs-table-select="delete_selected"]'),t=document.querySelector('[data-kt-docs-table-progress="progressbar"]'),r=document.querySelector('[data-kt-docs-table-progress="base"]');f.forEach(n=>{n.addEventListener("click",function(){setTimeout(function(){h()},50)})});e.addEventListener("click",function(){SwalConfirm.fire().then(function(u){if(u.value){r.classList.remove("d-none");let u=0,f=n.rows({selected:!0}).data().count();t.style.width=`${parseInt(u/f*100)}%`;t.innerHTML=`${parseInt(u/f*100)}%`;let e=[];for(let r=0;r<f;r++)e.push(fetch(`${i}/delete/${n.rows({selected:!0}).data()[r].id}`).then(n=>n.json()).then(()=>{u++,t.style.width=`${parseInt(u/f*100)}%`,t.innerHTML=`${parseInt(u/f*100)}%`}).catch(()=>toastr.error("خطای سرور")));Promise.all(e).then(function(){n.draw();setTimeout(()=>{r.classList.add("d-none"),toastr.success("عملیات انجام شد")},543)}).catch(()=>toastr.error("خطای سرور"))}})})},h=function(){const u=document.querySelector("#kt_datatable_example_1"),n=document.querySelector('[data-kt-docs-table-toolbar="base"]'),t=document.querySelector('[data-kt-docs-table-toolbar="selected"]'),f=document.querySelector('[data-kt-docs-table-select="selected_count"]'),e=u.querySelectorAll('tbody [type="checkbox"]');let i=!1,r=0;e.forEach(n=>{n.checked&&(i=!0,r++)});i?(f.innerHTML=r,n.classList.add("d-none"),t.classList.remove("d-none")):(n.classList.remove("d-none"),t.classList.add("d-none"))};return{init:function(){a();y();s();o();w();v();p()}}}(),KTDocsAdd;KTUtil.onDOMContentLoaded(function(){KTDatatablesServerSide.init()});KTDocsAdd=function(){return{init:function(){const f="/users",i=document.getElementById("info_modal"),n=i.querySelector("#modal_form"),r=new bootstrap.Modal(i),e=KTPasswordMeter.getInstance(n.querySelector('[data-kt-password-meter="true"]')),o=function(){return e.getScore()>=80};var u=FormValidation.formValidation(n,{fields:{userName:{validators:{notEmpty:{message:"نام کاربری را وارد نکرده اید"}}},email:{validators:{notEmpty:{message:"ایمیل را وارد نکرده اید"}}},phoneNumber:{validators:{notEmpty:{message:"شماره همراه را وارد نکرده اید"}}},password:{validators:{callback:{message:"کلمه عبور را وارد نکرده اید",callback:function(){let t=n.querySelector('[name="id"]');return t.value===""}},callback2:{message:"کلمه عبور ایمن نیست",callback2:function(n){if(n.value.length>0)return o()}}}},confirmPassword:{validators:{callback:{message:"تایید کلمه عبور را وارد نکرده اید",callback:function(t){let i=n.querySelector('[name="password"]');return i.value===""?!0:t.value!==""}},identical:{compare:function(){return n.querySelector('[name="password"]').value},message:"تایید کلمه عبور مطابقت ندارد"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});const t=i.querySelector('[data-kt-docs-modal-action="submit"]');t.addEventListener("click",i=>{i.preventDefault(),u&&u.validate().then(function(i){"Valid"==i?(t.setAttribute("data-kt-indicator","on"),t.disabled=!0,fetch(`${f}/upsert`,{method:"POST",body:new FormData(n)}).then(n=>n.json()).then(n=>{console.log(n),t.removeAttribute("data-kt-indicator"),t.disabled=!1,n.status==1?(toastr.success(n.message),i.isConfirmed,r.hide()):(toastr.error(n.message),n.errors.forEach(n=>{toastr.warning(n)}))}).catch(n=>{console.log(n)})):(toastr.warning("لطفا اطلاعات فرم را تکمیل کنید"),console.log(i))})});i.querySelector('[data-kt-docs-modal-action="cancel"]').addEventListener("click",t=>{t.preventDefault(),n.reset(),r.hide()})}}}();KTUtil.onDOMContentLoaded(function(){KTDocsAdd.init()});